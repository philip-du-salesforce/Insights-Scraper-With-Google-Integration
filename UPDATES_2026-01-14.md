# Updates - January 14, 2026

## Summary of Changes

### 1. Fixed Active User Counting with Pagination (Profiles Module)

**Problem:** Active users on page 2+ weren't being counted when scraping profiles.

**Solution:** 
- Added `countActiveUsersWithPagination()` method to ProfilesModule
- Implemented pagination logic that:
  - Counts active users on current page
  - Looks for "Next" button
  - Clicks it and waits for page to load
  - Repeats until no more pages
- Added `clickNextPageButtonFunc()` injectable function to handle pagination clicks

**Files Modified:**
- `modules/profiles-module.js`

### 2. Enhanced Progress Tracking for Profiles

**Problem:** Progress bar didn't show specific profile counts.

**Solution:**
- Modified the `scrape()` method to send detailed progress updates
- Progress now shows: "Scraping profile X of Y"
- Progress percentage based on: `(current / totalProfiles) * 100`
- Updated module-manager to pass `progressCallback` to modules via context
- Updated background.js to forward all progress messages to popup

**Files Modified:**
- `modules/profiles-module.js` - Added progress callbacks in scrape loop
- `modules/module-manager.js` - Pass progressCallback in enriched context
- `background.js` - Forward progress updates directly to popup

### 3. Implemented Storage Module

**Features:**
- Searches for "Storage" in the search box
- Clicks on link with `id="CompanyResourceDisk_font"`
- Waits 10 seconds for page load
- Scrapes all related lists with `class="listRelatedObject"`
- Extracts table data (headers and rows) from each related list
- Formats output as tab-separated text for Excel

**Output Format:**
```
STORAGE INFORMATION REPORT
Generated: [timestamp]
Total Related Lists: X

=== [Related List Title] ===
Header1	Header2	Header3
Value1	Value2	Value3
...
```

**Files Created:**
- `modules/storage-module.js`

### 4. Implemented Sandboxes Module

**Features:**
- Searches for "Sandboxes" in the search box
- Clicks on link with `id="DataManagementCreateTestInstance_font"`
- Waits 10 seconds for page load
- Scrapes the detail list table with `class="detailList"`
- Extracts label/value pairs from the table
- Formats output as tab-separated text for Excel

**Output Format:**
```
SANDBOXES INFORMATION REPORT
Generated: [timestamp]
Total Sandboxes: X

Label	Value
Label1	Value1
Label2	Value2
...
```

**Files Created:**
- `modules/sandboxes-module.js`

## Technical Details

### Pagination Implementation

The pagination logic works by:
1. Counting active users on the current page using existing `countActiveUsersFunc()`
2. Looking for pagination links using multiple strategies:
   - Links with class `.paginator` or `.pagination`
   - Links with title containing "Next"
   - Links with text "next"
   - Image-based next buttons
3. Clicking the next button if found
4. Waiting 3 seconds for page load
5. Repeating until no "Next" button is found

### Progress Callback Flow

```
Module scrape() 
  → calls context.progressCallback({ type: 'MODULE_PROGRESS', ... })
    → Module Manager receives it in enrichedContext
      → Forwards to background.js progressCallback
        → background.js forwards to popup via sendMessageToPopup()
          → Popup updates progress bar
```

## Testing Instructions

1. **Reload the extension** in Chrome (`chrome://extensions/` → reload button)

2. **Test Profiles with pagination:**
   - Select "Scrap Profiles"
   - Click "Extract Data"
   - Progress should show "Scraping profile X of Y"
   - Active users should be counted across all pages
   - File downloads automatically when complete

3. **Test Storage module:**
   - Select "Scrap Storage"
   - Click "Extract Data"
   - Should navigate to Storage page
   - Scrapes all related lists
   - Downloads `storage_data.txt`

4. **Test Sandboxes module:**
   - Select "Scrap Sandboxes"
   - Click "Extract Data"
   - Should navigate to Sandboxes page
   - Scrapes detail list table
   - Downloads `sandboxes_data.txt`

## Files Modified/Created

### Modified:
- `modules/profiles-module.js` - Added pagination and progress tracking
- `modules/module-manager.js` - Pass progressCallback to modules
- `background.js` - Forward progress updates to popup

### Created:
- `modules/storage-module.js` - New Storage module
- `modules/sandboxes-module.js` - New Sandboxes module
- `UPDATES_2026-01-14.md` - This file

## Next Steps

Remaining modules to implement:
- Sensitive Data module
- Login History module
